{"entries":[{"timestamp":1768516538906,"editorVersion":"8.0.18","changes":[{"type":"edited","filename":"main.blocks","patch":[{"start1":0,"length1":237,"diffs":[[1,"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>"]]}]},{"type":"edited","filename":"main.ts","patch":[{"start1":0,"length1":33,"diffs":[[1,"\n"]]}]},{"type":"edited","filename":"pxt.json","patch":[{"start1":202,"length1":41,"diffs":[[1,"        \"README.md\"\n"]]},{"start1":229,"length1":75,"diffs":[[1,"    \"additionalFilePaths\": []\n"]]}]},{"type":"added","filename":"test.ts","value":"// testene settes inn her; disse vil ikke kompilert så lenge denne pakken blir brukt som en utvidelse.\n"},{"type":"added","filename":"BME280.ts","value":"/**\n * makecode BME280 digital pressure and humidity sensor Package.\n * From microbit/micropython Chinese community.\n * http://www.micropython.org.cn\n */\n\nenum BME280_I2C_ADDRESS {\n    //% block=\"0x76\"\n    ADDR_0x76 = 0x76,\n    //% block=\"0x77\"\n    ADDR_0x77 = 0x77\n}\n\nenum BME280_T {\n    //% block=\"C\"\n    T_C = 0,\n    //% block=\"F\"\n    T_F = 1\n}\n\nenum BME280_P {\n    //% block=\"Pa\"\n    Pa = 0,\n    //% block=\"hPa\"\n    hPa = 1\n}\n\n/**\n * BME280 block\n */\n//% weight=100 color=#70c0f0 icon=\"\\uf042\" block=\"BME280\"\nnamespace BME280 {\n    let BME280_I2C_ADDR = BME280_I2C_ADDRESS.ADDR_0x76\n\n    function setreg(reg: number, dat: number): void {\n        let buf = pins.createBuffer(2);\n        buf[0] = reg;\n        buf[1] = dat;\n        pins.i2cWriteBuffer(BME280_I2C_ADDR, buf);\n    }\n\n    function getreg(reg: number): number {\n        pins.i2cWriteNumber(BME280_I2C_ADDR, reg, NumberFormat.UInt8BE);\n        return pins.i2cReadNumber(BME280_I2C_ADDR, NumberFormat.UInt8BE);\n    }\n\n    function getInt8LE(reg: number): number {\n        pins.i2cWriteNumber(BME280_I2C_ADDR, reg, NumberFormat.UInt8BE);\n        return pins.i2cReadNumber(BME280_I2C_ADDR, NumberFormat.Int8LE);\n    }\n\n    function getUInt16LE(reg: number): number {\n        pins.i2cWriteNumber(BME280_I2C_ADDR, reg, NumberFormat.UInt8BE);\n        return pins.i2cReadNumber(BME280_I2C_ADDR, NumberFormat.UInt16LE);\n    }\n\n    function getInt16LE(reg: number): number {\n        pins.i2cWriteNumber(BME280_I2C_ADDR, reg, NumberFormat.UInt8BE);\n        return pins.i2cReadNumber(BME280_I2C_ADDR, NumberFormat.Int16LE);\n    }\n\n    let dig_T1 = getUInt16LE(0x88)\n    let dig_T2 = getInt16LE(0x8A)\n    let dig_T3 = getInt16LE(0x8C)\n    let dig_P1 = getUInt16LE(0x8E)\n    let dig_P2 = getInt16LE(0x90)\n    let dig_P3 = getInt16LE(0x92)\n    let dig_P4 = getInt16LE(0x94)\n    let dig_P5 = getInt16LE(0x96)\n    let dig_P6 = getInt16LE(0x98)\n    let dig_P7 = getInt16LE(0x9A)\n    let dig_P8 = getInt16LE(0x9C)\n    let dig_P9 = getInt16LE(0x9E)\n    let dig_H1 = getreg(0xA1)\n    let dig_H2 = getInt16LE(0xE1)\n    let dig_H3 = getreg(0xE3)\n    let a = getreg(0xE5)\n    let dig_H4 = (getreg(0xE4) << 4) + (a % 16)\n    let dig_H5 = (getreg(0xE6) << 4) + (a >> 4)\n    let dig_H6 = getInt8LE(0xE7)\n    setreg(0xF2, 0x04)\n    setreg(0xF4, 0x2F)\n    setreg(0xF5, 0x0C)\n    let T = 0\n    let P = 0\n    let H = 0\n\n    function get(): void {\n        let adc_T = (getreg(0xFA) << 12) + (getreg(0xFB) << 4) + (getreg(0xFC) >> 4)\n        let var1 = (((adc_T >> 3) - (dig_T1 << 1)) * dig_T2) >> 11\n        let var2 = (((((adc_T >> 4) - dig_T1) * ((adc_T >> 4) - dig_T1)) >> 12) * dig_T3) >> 14\n        let t = var1 + var2\n        T = Math.idiv((t * 5 + 128) >> 8, 100)\n        var1 = (t >> 1) - 64000\n        var2 = (((var1 >> 2) * (var1 >> 2)) >> 11) * dig_P6\n        var2 = var2 + ((var1 * dig_P5) << 1)\n        var2 = (var2 >> 2) + (dig_P4 << 16)\n        var1 = (((dig_P3 * ((var1 >> 2) * (var1 >> 2)) >> 13) >> 3) + (((dig_P2) * var1) >> 1)) >> 18\n        var1 = ((32768 + var1) * dig_P1) >> 15\n        if (var1 == 0)\n            return; // avoid exception caused by division by zero\n        let adc_P = (getreg(0xF7) << 12) + (getreg(0xF8) << 4) + (getreg(0xF9) >> 4)\n        let _p = ((1048576 - adc_P) - (var2 >> 12)) * 3125\n        _p = Math.idiv(_p, var1) * 2;\n        var1 = (dig_P9 * (((_p >> 3) * (_p >> 3)) >> 13)) >> 12\n        var2 = (((_p >> 2)) * dig_P8) >> 13\n        P = _p + ((var1 + var2 + dig_P7) >> 4)\n        let adc_H = (getreg(0xFD) << 8) + getreg(0xFE)\n        var1 = t - 76800\n        var2 = (((adc_H << 14) - (dig_H4 << 20) - (dig_H5 * var1)) + 16384) >> 15\n        var1 = var2 * (((((((var1 * dig_H6) >> 10) * (((var1 * dig_H3) >> 11) + 32768)) >> 10) + 2097152) * dig_H2 + 8192) >> 14)\n        var2 = var1 - (((((var1 >> 15) * (var1 >> 15)) >> 7) * dig_H1) >> 4)\n        if (var2 < 0) var2 = 0\n        if (var2 > 419430400) var2 = 419430400\n        H = (var2 >> 12) >> 10\n    }\n\n    /**\n     * get pressure\n     */\n    //% blockId=\"BME280_GET_PRESSURE\" block=\"Trykk %u\"\n    //% weight=80 blockGap=8\n    export function pressure(u: BME280_P): number {\n        get();\n        if (u == BME280_P.Pa) return P;\n        else return Math.idiv(P, 100)\n    }\n\n    /**\n     * get temperature\n     */\n    //% blockId=\"BME280_GET_TEMPERATURE\" block=\"Temperatur %u\"\n    //% weight=80 blockGap=8\n    export function temperature(u: BME280_T): number {\n        get();\n        if (u == BME280_T.T_C) return T;\n        else return 32 + Math.idiv(T * 9, 5)\n    }\n\n    /**\n     * get humidity\n     */\n    //% blockId=\"BME280_GET_HUMIDITY\" block=\"Luftfuktighet\"\n    //% weight=80 blockGap=8\n    export function humidity(): number {\n        get();\n        return H;\n    }\n\n    /**\n     * power on\n     */\n    //% blockId=\"BME280_POWER_ON\" block=\"Skru PÅ\"\n    //% weight=22 blockGap=8\n    export function PowerOn() {\n        setreg(0xF4, 0x2F)\n    }\n\n    /**\n     * power off\n     */\n    //% blockId=\"BME280_POWER_OFF\" block=\"Skru AV\"\n    //% weight=21 blockGap=8\n    export function PowerOff() {\n        setreg(0xF4, 0)\n    }\n\n    /**\n     * Calculate Dewpoint\n     */\n    //% block=\"Duggpunkt\"\n    //% weight=60 blockGap=8\n    export function Dewpoint(): number {\n        get();\n        return T - Math.idiv(100 - H, 5)\n    }\n\n    /**\n     * Pressure below Event\n     */\n    //% block=\"Trykk lavere enn %dat\" dat.defl=100000\n    export function PressureBelowThan(dat: number, body: () => void): void {\n        control.inBackground(function () {\n            while (true) {\n                get()\n                if (P < dat) {\n                    body()\n                }\n                basic.pause(1000)\n            }\n        })\n    }\n\n    /**\n     * Pressure higher Event\n     */\n    //% block=\"Trykk høyere enn %dat\" dat.defl=100000\n    export function PressureHigherThan(dat: number, body: () => void): void {\n        control.inBackground(function () {\n            while (true) {\n                get()\n                if (P > dat) {\n                    body()\n                }\n                basic.pause(1000)\n            }\n        })\n    }\n\n    /**\n     * humidity below Event\n     */\n    //% block=\"Luftfuktighet lavere enn %dat\" dat.defl=10\n    export function HumidityBelowThan(dat: number, body: () => void): void {\n        control.inBackground(function () {\n            while (true) {\n                get()\n                if (H < dat) {\n                    body()\n                }\n                basic.pause(1000)\n            }\n        })\n    }\n\n    /**\n     * humidity higher Event\n     */\n    //% block=\"Luftfuktighet høyere enn %dat\" dat.defl=50\n    export function HumidityHigherThan(dat: number, body: () => void): void {\n        control.inBackground(function () {\n            while (true) {\n                get()\n                if (H > dat) {\n                    body()\n                }\n                basic.pause(1000)\n            }\n        })\n    }\n\n    /**\n     * temperature below Event\n     */\n    //% block=\"Temperatur lavere enn %dat\" dat.defl=10\n    export function TemperatureBelowThan(dat: number, body: () => void): void {\n        control.inBackground(function () {\n            while (true) {\n                get()\n                if (T < dat) {\n                    body()\n                }\n                basic.pause(1000)\n            }\n        })\n    }\n\n    /**\n     * temperature higher Event\n     */\n    //% block=\"Temperatur høyere enn %dat\" dat.defl=30\n    export function TemperatureHigherThan(dat: number, body: () => void): void {\n        control.inBackground(function () {\n            while (true) {\n                get()\n                if (T > dat) {\n                    body()\n                }\n                basic.pause(1000)\n            }\n        })\n    }\n\n    /**\n     * set I2C address\n     */\n    //% blockId=\"BME280_SET_ADDRESS\" block=\"Sett adresse %addr\"\n    //% weight=20 blockGap=8\n    export function Address(addr: BME280_I2C_ADDRESS) {\n        BME280_I2C_ADDR = addr\n    }\n}"}]}],"snapshots":[{"timestamp":1768516538905,"editorVersion":"8.0.18","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"BME280\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}}],"shares":[],"lastSaveTime":1768516837896}